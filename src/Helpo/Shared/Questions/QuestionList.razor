@page "/questions"

<AuthorizeView>
    <Authorized>
        <MudButton Variant="Variant.Filled" 
                   Color="Color.Primary"
                   Link="/questions/ask">
            Ask new question
        </MudButton>
    </Authorized>
</AuthorizeView>

<MudDataGrid T="QuestionViewModel" class="mt-4" ServerData="@LoadQuestions" RowClick="@QuestionClicked" CurrentPage="@Page">
    <Columns>
        @* <Column T="QuestionViewModel" Field="HasAcceptedAnswer" Title="Has Answer" /> *@
        <Column T="QuestionViewModel" Field="Title" />
        <Column T="QuestionViewModel" Field="Content" />
        @* <Column T="QuestionViewModel" Field="Tags" />
        <Column T="QuestionViewModel" Field="AskedByUser" Title="Asked by" /> *@
    </Columns>
    <PagerContent>
        <MudDataGridPager T="QuestionViewModel" />
    </PagerContent>
</MudDataGrid>

@code {

    [Inject]
    public QuestionsService QuestionsService { get; set; } = default!;

    [Inject]
    public NavigationManager NavigationManager { get; set; } = default!;

    [Parameter]
    [SupplyParameterFromQuery]
    public int Page { get; set; } = 0;

    private async Task<GridData<QuestionViewModel>> LoadQuestions(GridState<QuestionViewModel> state)
    {
        this.NavigationManager.NavigateTo(this.NavigationManager.GetUriWithQueryParameter("page", state.Page));

        var (questions, totalCount) = await this.QuestionsService.GetQuestions(state.Page, state.PageSize, default);

        var result = new GridData<QuestionViewModel>();
        result.Items = questions;
        result.TotalItems = totalCount;

        return result;
    }

    private async Task QuestionClicked(DataGridRowClickEventArgs<QuestionViewModel> args)
    {
        var question = args.Item;
    }
}
